!function(factory){var L,proj4;if("function"==typeof define&&define.amd)define(["leaflet","proj4"],factory);else if("object"==typeof module&&"object"==typeof module.exports)L=require("leaflet"),proj4=require("proj4"),module.exports=factory(L,proj4);else{if(void 0===window.L||void 0===window.proj4)throw"Leaflet and proj4 must be loaded first";factory(window.L,window.proj4)}}((function(L,proj4){return proj4.__esModule&&proj4.default&&(proj4=proj4.default),L.Proj={},L.Proj._isProj4Obj=function(a){return void 0!==a.inverse&&void 0!==a.forward},L.Proj.Projection=L.Class.extend({initialize:function(code,def,bounds){var isP4=L.Proj._isProj4Obj(code);this._proj=isP4?code:this._projFromCodeDef(code,def),this.bounds=isP4?def:bounds},project:function(latlng){var point=this._proj.forward([latlng.lng,latlng.lat]);return new L.Point(point[0],point[1])},unproject:function(point,unbounded){var point2=this._proj.inverse([point.x,point.y]);return new L.LatLng(point2[1],point2[0],unbounded)},_projFromCodeDef:function(code,def){if(def)proj4.defs(code,def);else if(void 0===proj4.defs[code]){var urn=code.split(":");if(urn.length>3&&(code=urn[urn.length-3]+":"+urn[urn.length-1]),void 0===proj4.defs[code])throw"No projection definition for code "+code}return proj4(code)}}),L.Proj.CRS=L.Class.extend({includes:L.CRS,options:{transformation:new L.Transformation(1,0,-1,0)},initialize:function(a,b,c){var code,proj,def,options;if(L.Proj._isProj4Obj(a)?(code=(proj=a).srsCode,options=b||{},this.projection=new L.Proj.Projection(proj,options.bounds)):(code=a,def=b,options=c||{},this.projection=new L.Proj.Projection(code,def,options.bounds)),L.Util.setOptions(this,options),this.code=code,this.transformation=this.options.transformation,this.options.origin&&(this.transformation=new L.Transformation(1,-this.options.origin[0],-1,this.options.origin[1])),this.options.scales)this._scales=this.options.scales;else if(this.options.resolutions){this._scales=[];for(var i=this.options.resolutions.length-1;i>=0;i--)this.options.resolutions[i]&&(this._scales[i]=1/this.options.resolutions[i])}this.infinite=!this.options.bounds},scale:function(zoom){var iZoom=Math.floor(zoom),baseScale,nextScale,scaleDiff,zDiff;return zoom===iZoom?this._scales[zoom]:(baseScale=this._scales[iZoom])+(scaleDiff=(nextScale=this._scales[iZoom+1])-baseScale)*(zDiff=zoom-iZoom)},zoom:function(scale){var downScale=this._closestElement(this._scales,scale),downZoom=this._scales.indexOf(downScale),nextScale,nextZoom,scaleDiff;return scale===downScale?downZoom:void 0===downScale?-1/0:(nextZoom=downZoom+1,void 0===(nextScale=this._scales[nextZoom])?1/0:(scale-downScale)/(scaleDiff=nextScale-downScale)+downZoom)},distance:L.CRS.Earth.distance,R:L.CRS.Earth.R,_closestElement:function(array,element){for(var low,i=array.length;i--;)array[i]<=element&&(void 0===low||low<array[i])&&(low=array[i]);return low}}),L.Proj.GeoJSON=L.GeoJSON.extend({initialize:function(geojson,options){this._callLevel=0,L.GeoJSON.prototype.initialize.call(this,geojson,options)},addData:function(geojson){var crs;geojson&&(geojson.crs&&"name"===geojson.crs.type?crs=new L.Proj.CRS(geojson.crs.properties.name):geojson.crs&&geojson.crs.type&&(crs=new L.Proj.CRS(geojson.crs.type+":"+geojson.crs.properties.code)),void 0!==crs&&(this.options.coordsToLatLng=function(coords){var point=L.point(coords[0],coords[1]);return crs.projection.unproject(point)})),this._callLevel++;try{L.GeoJSON.prototype.addData.call(this,geojson)}finally{this._callLevel--,0===this._callLevel&&delete this.options.coordsToLatLng}}}),L.Proj.geoJson=function(geojson,options){return new L.Proj.GeoJSON(geojson,options)},L.Proj.ImageOverlay=L.ImageOverlay.extend({initialize:function(url,bounds,options){L.ImageOverlay.prototype.initialize.call(this,url,null,options),this._projectedBounds=bounds},_animateZoom:function(event){var scale=this._map.getZoomScale(event.zoom),northWest=L.point(this._projectedBounds.min.x,this._projectedBounds.max.y),offset=this._projectedToNewLayerPoint(northWest,event.zoom,event.center);L.DomUtil.setTransform(this._image,offset,scale)},_reset:function(){var zoom=this._map.getZoom(),pixelOrigin=this._map.getPixelOrigin(),bounds=L.bounds(this._transform(this._projectedBounds.min,zoom)._subtract(pixelOrigin),this._transform(this._projectedBounds.max,zoom)._subtract(pixelOrigin)),size=bounds.getSize();L.DomUtil.setPosition(this._image,bounds.min),this._image.style.width=size.x+"px",this._image.style.height=size.y+"px"},_projectedToNewLayerPoint:function(point,zoom,center){var viewHalf=this._map.getSize()._divideBy(2),newTopLeft,topLeft=this._map.project(center,zoom)._subtract(viewHalf)._round().add(this._map._getMapPanePos());return this._transform(point,zoom)._subtract(topLeft)},_transform:function(point,zoom){var crs=this._map.options.crs,transformation=crs.transformation,scale=crs.scale(zoom);return transformation.transform(point,scale)}}),L.Proj.imageOverlay=function(url,bounds,options){return new L.Proj.ImageOverlay(url,bounds,options)},L.Proj}));