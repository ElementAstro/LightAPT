<!--

   Copyright(c) 2022-2023 Max Qian  <astroair.cn>

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.
   
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
   
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
   MA 02110-1301, USA.
   
-->

<!DOCTYPE html>
<html lang="en">

<head>
    
    {{ basic.load_basic_meta() }}

    <title>Tools</title>

    {{ basic.icon() }}

    <!-- Bootstrap select -->
    <link rel="stylesheet" href="/static/css/bootstrap/bootstrap-select.min.css">
    <!-- Loading animation -->
    <link rel="stylesheet" href="/static/css/client/loading.css">
    <!-- overlayScrollbars -->
	<link rel="stylesheet" href="/static/css/plugins/OverlayScrollbars.min.css">
    <!-- OpenLayer -->
    <link rel="stylesheet" href="/static/css/plugins/ol.min.css">
    <!-- Tools -->
    <link rel="stylesheet" href="/static/css/client/tools.css">

    {{ basic.load_basic_css() }}

</head>

<body style="height: auto;" class="sidebar-mini sidebar-closed sidebar-collapse dark-mode">
    
    {{ basic.loading() }}
    
    <div class="wrapper">
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-6">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card card-default card-primary collapsed-card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-timer"></i>
                                            时间同步
                                        </div>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool"
                                                data-card-widget="collapse" title="Collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="input-group input-group-sm">
                                                    <input type='text' class='form-control form-control-sm text-white text-center bg-dark'
                                                            id='time' placeholder="客户端时间">
                                                    <button id='get_time' class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-times-circle"></i>
                                                        获取
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-1">
                                            <div class="col-sm-12">
                                                <div class="input-group input-group-sm">
                                                    <div class="col p-0">
                                                        <button id='sync_time' class="btn btn-sm btn-outline-primary btn-block">
                                                            <i class="fas fa-sync"></i>
                                                            同步
                                                        </button>
                                                    </div>
                                                    <div class="col p-0">
                                                        <button id='reset_time' class="btn btn-sm btn-outline-warning btn-block">
                                                            <i class="fas fa-redo"></i>
                                                            重置
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-sm-12">
                                                <div id="time_error" hidden class=" alert alert-danger alert-dismissible">
                                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                                    <h5><i class="icon fas fa-ban"></i>错误</h5>
                                                    <p id="time_error_message"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-sm-12">
                                                <div id="time_info" hidden class="alert alert-info alert-dismissible">
                                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                                    <h5><i class="icon fas fa-info"></i>提示</h5>
                                                    <p id="time_info_message"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card card-default card-info collapsed-card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-satellite"></i>
                                            定位
                                        </div>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool"
                                                data-card-widget="collapse" title="Collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="input-group input-group-sm">
                                                    <div class="col p-0">
                                                        <label>经度</label>
                                                        <input type='text' class='form-control form-control-sm text-white text-center bg-dark'
                                                                id='lon' placeholder="">
                                                    </div>
                                                    <div class="col p-0">
                                                        <label>纬度</label>
                                                        <input type='text' class='form-control form-control-sm text-white text-center bg-dark'
                                                        id='lat' placeholder="">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-1">
                                            <div class="col-sm-12">
                                                <div class="input-group input-group-sm">
                                                    <div class="col p-0">
                                                        <button id='get_location' class="btn btn-sm btn-outline-warning btn-block">
                                                            <i class="fas fa-refresh"></i>
                                                            获取
                                                        </button>
                                                    </div>
                                                    <div class="col p-0">
                                                        <button id='sync_location' class="btn btn-sm btn-outline-primary btn-block">
                                                            <i class="fas fa-sync"></i>
                                                            同步
                                                        </button>
                                                    </div>
                                                    <div class="col p-0">
                                                        <button id='reset_location' class="btn btn-sm btn-outline-danger btn-block">
                                                            <i class="fas fa-redo"></i>
                                                            重置
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-sm-12">
                                                <div id="location_error" hidden class=" alert alert-danger alert-dismissible">
                                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                                    <h5><i class="icon fas fa-ban"></i>错误</h5>
                                                    <p id="location_error_message"></p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row pt-2">
                                            <div class="col-sm-12">
                                                <div id="location_info" hidden class="alert alert-info alert-dismissible">
                                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                                                    <h5><i class="icon fas fa-info"></i>提示</h5>
                                                    <p id="location_info_message"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card card-default card-indigo collapsed-card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-soft-serve"></i>
                                            更新
                                        </div>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool"
                                                data-card-widget="collapse" title="Collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col p-1">
                                                <button id='update_kstars' class="btn btn-sm btn-info btn-block">
                                                    <i class="fas fa-telescope"></i>
                                                    更新Kstars
                                                </button>
                                            </div>
                                            <div class="col p-1">
                                                <button id='update_phd2' class="btn btn-sm btn-primary btn-block">
                                                    <i class="fas fa-crosshairs"></i>
                                                    更新PHD2
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col p-1">
                                                <button id='update_astap' class="btn btn-sm btn-primary btn-block">
                                                    <i class="fas fa-camera-viewfinder"></i>
                                                    更新Astap
                                                </button>
                                            </div>
                                            <div class="col p-1">
                                                <button id='update_python' class="btn btn-sm btn-info btn-block">
                                                    <i class="fas fa-map"></i>
                                                    更新Python
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col p-1">
                                                <button id='update_plugins' class="btn btn-sm btn-info btn-block">
                                                    <i class="fas fa-plug"></i>
                                                    更新插件
                                                </button>
                                            </div>
                                            <div class="col p-1">
                                                <button id='update_all' class="btn btn-sm btn-primary btn-block">
                                                    <i class="fas fa-server"></i>
                                                    更新所有软件
                                                </button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <textarea id="update_log" rows="5" style="width: 100%; font-family: monospace;" readonly class="text-white form-control form-control-sm"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card card-default card-pink collapsed-card">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-file-download"></i>
                                            下载解析文件
                                        </div>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool"
                                                data-card-widget="collapse" title="Collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <div class="input-group d-flex">
                                                    <select id="solver" data-style="btn-outline-warning" class="selectpicker form-control form-control-sm pr-1">
                                                        <option value="astap">ASTAP</option>
                                                        <option value="astrometry">Astrometry</option>
                                                    </select>
                                                    <select id="template_list" data-live-search="true" data-style="btn-outline-primary" multiple class="selectpicker form-control form-control-sm">

                                                    </select>
                                                    <button id='refresh_template_list' class="btn btn-sm btn-outline-success p-0 pl-1">
                                                        <i class="fas fa-redo"></i>
                                                        刷新
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-12 pt-2">
                                                <button id='download_template' class="btn btn-sm btn-outline-primary btn-block">
                                                    <i class="fas fa-download"></i>
                                                    下载
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-sm-12">
                                <div class="card card-default card-white collapsed-card card-outline">
                                    <div class="card-header">
                                        <div class="card-title">
                                            <i class="fas fa-stack"></i>
                                            GPS
                                        </div>
                                        <div class="card-tools">
                                            <button type="button" class="btn btn-tool"
                                                data-card-widget="collapse" title="Collapse">
                                                <i class="fas fa-minus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body">

                                        <div class="panel_container">
                                            <h1>GPS Information</h1>
                                            <div id="displayctl">
                                                <button id="togglemap" onclick="togglemap();">Map</button>
                                                <button id="toggleskymap" onclick="toggleskymap();">Sky Map</button>
                                                <button id="togglegpsdetails" onclick="togglegpsdetails();">GPS Info</button>
                                            </div>
                                            <div id="mapcontainer">
                                                <div id="map" class="map">
                                                    Loading...
                                                    <noscript>
                                                        <span class='warning'>You must enable javascript to view the maps.</span><br/>
                                                    </noscript>
                                                </div>
                                            </div>
                                            <div id="skymapcontainer">
                                                <img id="skymap" src="/static/textures/icons/skymap.png"/>
                                                <p id="legend" >A filled circle means the satellite was used in the last fix. Colors indicate signal strength in dB.</p>
                                            </div>
                                            <div id="gpsdetailscontainer">
                                                <div id="gpsdetails">
                                                    <div id="gpsinfo">
                                                        <table>
                                                            <tr><th colspan=2 align=left><h2>GPS Status</h2></th></tr>
                                                            <tr><td class="gpshdr">Time</td><td><span id="gpstime"></span></td></tr>
                                                            <tr><td class="gpshdr">Latitude</td><td><span id="latitude"></span></td></tr>
                                                            <tr><td class="gpshdr">Longitude</td><td><span id="longitude"></span></td></tr>
                                                            <tr><td class="gpshdr">Altitude</td><td><span id="altitude"></span></td></tr>
                                                            <tr><td class="gpshdr">Fix Type</td><td><span id="mode"></span></td></tr>
                                                            <tr><td class="gpshdr">Satellites</td><td><span id="sats"></span></td></tr>
                                                            <tr><td class="gpshdr">HDOP</td><td><span id="hdop"></span></td></tr>
                                                            <tr><td class="gpshdr">VDOP</td><td><span id="vdop"></span></td></tr>
                                                        </table>
                                                    </div>
                                                    <div id="gpssats"></div>
                                                </div>
                                                <img id="sschart" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="/>
                                            </div>
                                            <div id="coordtime">
                                                <span class="label">Latitude</span><span id="lat" class="gpsvalues">&nbsp;</span>
                                                <span class="label">Longitude</span><span id="lon" class="gpsvalues">&nbsp;</span>
                                                <span class="label">UTC time</span><span id="gtime" class="gpsvalues">&nbsp;</span>
                                                <span id="gpsfix_obtained" class="label">Fix</span><span id="gpsfix" class="gpsvalues blink">waiting...</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    {{ basic.load_danger_model() }}

	{{ basic.load_warning_model() }}

	{{ basic.load_info_model() }}

    {{ basic.load_basic_js() }}

    <script type="text/javascript">
        function togglemap() {
                document.getElementById("mapcontainer").style.display="block";
                document.getElementById("skymapcontainer").style.display="none";
                document.getElementById("gpsdetailscontainer").style.display="none";
        }
        function toggleskymap() {
                document.getElementById("mapcontainer").style.display="none";
                document.getElementById("skymapcontainer").style.display="block";
                document.getElementById("gpsdetailscontainer").style.display="none";
        }
        function togglegpsdetails() {
                document.getElementById("mapcontainer").style.display="none";
                document.getElementById("skymapcontainer").style.display="none";
                document.getElementById("gpsdetailscontainer").style.display="block";
        }
        </script>
    
    <!-- Bootstrap select -->
    <script src="/static/js/bootstrap/bootstrap-select.min.js"></script>
    <!-- OpenLayer -->
    <script src="/static/js/plugins/ol.min.js"></script>
    <!-- SocketIO -->
    <script src="/static/js/plugins/socket.io.min.js"></script>
    <!-- Tools JS -->
    <script src="/static/js/client/tools.js"></script>
    <!-- overlayScrollbars -->
	<script src="/static/js/jquery/jquery.overlayScrollbars.min.js"></script>
	<script>
		$(function () {
			$('body').overlayScrollbars({});
		});
	</script>
    

</body>
</html>